<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Buscar — Tron Encyclopedia</title>
    <style>
        :root{--bg:#0b0b0f;--card:#0f1720;--accent:#00d1ff;--muted:#9aa4b2;--text:#e6eef6}
        html,body{height:100%}
        body{
            margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
            background:linear-gradient(180deg,#02030a 0%,#071428 100%);color:var(--text);
            -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
            padding:32px;
        }
        .container{max-width:900px;margin:0 auto}
        header{display:flex;align-items:center;gap:16px;margin-bottom:24px}
        a.home{color:var(--accent);text-decoration:none;font-weight:600}
        h1{margin:0;font-size:1.25rem}
        form.search{display:flex;gap:8px;margin-bottom:18px}
        input[type="search"]{
            flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);
            background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
            color:var(--text);outline:none;font-size:1rem;
        }
        button.btn{
            background:var(--accent);color:#04202a;border:0;padding:10px 14px;border-radius:10px;font-weight:600;
        }
        .meta{color:var(--muted);margin-bottom:12px;font-size:0.9rem}
        #results{display:grid;gap:12px}
        .card{
            background:var(--card);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);
            transition:transform .12s ease,box-shadow .12s ease;
        }
        .card:hover{transform:translateY(-4px);box-shadow:0 10px 30px rgba(2,6,23,0.6)}
        .card a.title{color:var(--accent);text-decoration:none;font-weight:700}
        .card p.excerpt{color:var(--text);margin:8px 0 6px}
        .tags{color:var(--muted);font-size:0.85rem}
        .empty{color:var(--muted);padding:28px;text-align:center;border-radius:10px;background:rgba(255,255,255,0.01)}
        mark{background:rgba(0,209,255,0.14);color:var(--accent);padding:0 3px;border-radius:3px}
        footer{margin-top:28px;color:var(--muted);font-size:0.9rem}
        @media (max-width:520px){body{padding:18px}}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a class="home" href="/"><strong>Tron Encyclopedia</strong></a>
            <h1>Buscar</h1>
        </header>

        <form id="searchForm" class="search" role="search" onsubmit="return false;">
            <input id="searchInput" type="search" placeholder="Buscar artículos, personajes, tecnología..." aria-label="Buscar" />
            <button id="searchBtn" class="btn" aria-label="Buscar">Buscar</button>
        </form>

        <div class="meta" id="meta">Introduce un término para comenzar la búsqueda.</div>

        <main id="results" aria-live="polite"></main>

        <footer>Resultados mostrados desde el índice local. Si no hay datos, genere el índice de búsqueda.</footer>
    </div>

    <script>
        // Estructura esperada para SEARCH_INDEX:
        // window.SEARCH_INDEX = [
        //   { title: 'Título', url: '/ruta/al-articulo', excerpt: 'Resumen breve...', tags: ['tron','personaje'] },
        //   ...
        // ];
        // Reemplace con su índice real (por ejemplo: cargar search-index.js que define window.SEARCH_INDEX)

        const input = document.getElementById('searchInput');
        const resultsEl = document.getElementById('results');
        const metaEl = document.getElementById('meta');
        const btn = document.getElementById('searchBtn');
        const form = document.getElementById('searchForm');

        // Fallback si no existe un índice; puede dejar vacío y generar índice externo.
        window.SEARCH_INDEX = window.SEARCH_INDEX || [];

        function getQueryParam(name){
            const params = new URLSearchParams(location.search);
            return params.get(name) || '';
        }

        function highlight(text, terms){
            if(!terms.length) return escapeHtml(text);
            let out = escapeHtml(text);
            terms.forEach(t=>{
                if(!t) return;
                const re = new RegExp('('+escapeRegExp(t)+')','ig');
                out = out.replace(re,'<mark>$1</mark>');
            });
            return out;
        }

        function escapeHtml(str){
            return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
        }

        function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

        function renderResults(list, terms){
            resultsEl.innerHTML = '';
            if(!list.length){
                resultsEl.innerHTML = '<div class="empty">No se han encontrado resultados.</div>';
                metaEl.textContent = '0 resultados';
                return;
            }
            metaEl.textContent = `${list.length} resultado(s)`;
            const frag = document.createDocumentFragment();
            list.forEach(item=>{
                const div = document.createElement('article');
                div.className = 'card';
                const title = document.createElement('a');
                title.className = 'title';
                title.href = item.url || '#';
                title.innerHTML = highlight(item.title || 'Sin título', terms);
                const excerpt = document.createElement('p');
                excerpt.className = 'excerpt';
                excerpt.innerHTML = highlight(item.excerpt || '', terms);
                const tags = document.createElement('div');
                tags.className = 'tags';
                tags.textContent = (item.tags || []).join(' · ');
                div.appendChild(title);
                div.appendChild(excerpt);
                if((item.tags||[]).length) div.appendChild(tags);
                frag.appendChild(div);
            });
            resultsEl.appendChild(frag);
        }

        function search(query){
            const q = String(query || '').trim();
            if(!q){
                metaEl.textContent = 'Introduce un término para comenzar la búsqueda.';
                resultsEl.innerHTML = '';
                return;
            }
            const terms = q.split(/\s+/).filter(Boolean);
            // Simple puntuación: coincidencias en título peso 3, excerpt peso 1, tags weight 2
            const results = window.SEARCH_INDEX
                .map(item=>{
                    const haystack = ((item.title||'') + ' ' + (item.excerpt||'') + ' ' + (item.tags||[]).join(' ')).toLowerCase();
                    let score = 0;
                    terms.forEach(t=>{
                        const tt = t.toLowerCase();
                        if((item.title||'').toLowerCase().includes(tt)) score += 3;
                        if((item.tags||[]).join(' ').toLowerCase().includes(tt)) score += 2;
                        if((item.excerpt||'').toLowerCase().includes(tt)) score += 1;
                    });
                    return Object.assign({score}, item);
                })
                .filter(i => i.score > 0)
                .sort((a,b)=> b.score - a.score);
            renderResults(results, terms);
        }

        // Live search with debounce
        let timer = null;
        input.addEventListener('input', ()=>{
            clearTimeout(timer);
            timer = setTimeout(()=> {
                const q = input.value;
                history.replaceState(null,'', q ? '?q='+encodeURIComponent(q) : location.pathname);
                search(q);
            }, 200);
        });

        btn.addEventListener('click', ()=> search(input.value));
        form.addEventListener('submit', e => { e.preventDefault(); search(input.value); });

        // Ejecutar al cargar si hay ?q=
        const initialQ = getQueryParam('q');
        if(initialQ){
            input.value = initialQ;
            search(initialQ);
        }

        // Si no hay índice, mostrar indicación
        if(!window.SEARCH_INDEX.length){
            resultsEl.innerHTML = '<div class="empty">Índice de búsqueda vacío. Genere un archivo de índice (por ejemplo: search-index.js) que establezca window.SEARCH_INDEX con los artículos del proyecto.</div>';
            metaEl.textContent = 'Índice vacío';
        }
    </script>
</body>
</html>
</form>